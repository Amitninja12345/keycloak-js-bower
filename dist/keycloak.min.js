(function(a,c){var b=function(u){if(!(this instanceof b)){return new b(u)}var g=this;var m;var q={enable:true,callbackMap:[],interval:5};g.init=function(y){g.authenticated=false;if(a.Cordova){m=s("cordova")}else{m=s()}if(y){if(typeof y.checkLoginIframe!=="undefined"){q.enable=y.checkLoginIframe}if(y.checkLoginIframeInterval){q.interval=y.checkLoginIframeInterval}if(y.onLoad==="login-required"){g.loginRequired=true}}var z=d();var w=d();w.promise.success(function(){g.onReady&&g.onReady(g.authenticated);z.setSuccess(g.authenticated)}).error(function(){z.setError()});var x=h(u);function v(){var C=f(a.location.search);if(C){a.history.replaceState({},null,location.protocol+"//"+location.host+location.pathname+(C.fragment?"#"+C.fragment:""));j(C,w);return}else{if(y){var B=function(D){if(!D){A.prompt="none"}g.login(A).success(function(){w.setSuccess()}).error(function(){w.setError()})};if(y.token||y.refreshToken){p(y.token,y.refreshToken);w.setSuccess()}else{if(y.onLoad){var A={};switch(y.onLoad){case"check-sso":if(q.enable){t().success(function(){i().success(function(){B(false)}).error(function(){w.setSuccess()})})}else{B(false)}break;case"login-required":B(true);break;default:throw"Invalid value for onLoad"}}}}else{w.setSuccess()}}}x.success(v);x.error(function(){z.setError()});return z.promise};g.login=function(v){return m.login(v)};g.createLoginUrl=function(w){var x=e();var y=m.redirectUri(w);if(w&&w.prompt){if(y.indexOf("?")==-1){y+="?prompt="+w.prompt}else{y+="&prompt="+w.prompt}}sessionStorage.oauthState=x;var v=l()+"/tokens/login?client_id="+encodeURIComponent(g.clientId)+"&redirect_uri="+encodeURIComponent(y)+"&state="+encodeURIComponent(x)+"&response_type=code";if(w&&w.prompt){v+="&prompt="+w.prompt}if(w&&w.loginHint){v+="&login_hint="+w.loginHint}return v};g.logout=function(v){return m.logout(v)};g.createLogoutUrl=function(w){var v=l()+"/tokens/logout?redirect_uri="+encodeURIComponent(m.redirectUri(w));return v};g.createAccountUrl=function(w){var v=l()+"/account?referrer="+encodeURIComponent(g.clientId)+"&referrer_uri="+encodeURIComponent(m.redirectUri(w));return v};g.accountManagement=function(){return m.accountManagement()};g.hasRealmRole=function(w){var v=g.realmAccess;return !!v&&v.roles.indexOf(w)>=0};g.hasResourceRole=function(x,w){if(!g.resourceAccess){return false}var v=g.resourceAccess[w||g.clientId];return !!v&&v.roles.indexOf(x)>=0};g.loadUserProfile=function(){var v=l()+"/account";var w=new XMLHttpRequest();w.open("GET",v,true);w.setRequestHeader("Accept","application/json");w.setRequestHeader("Authorization","bearer "+g.token);var x=d();w.onreadystatechange=function(){if(w.readyState==4){if(w.status==200){g.profile=JSON.parse(w.responseText);x.setSuccess(g.profile)}else{x.setError()}}};w.send();return x.promise};g.isTokenExpired=function(v){if(!g.tokenParsed||!g.refreshToken){throw"Not authenticated"}var w=g.tokenParsed.exp-(new Date().getTime()/1000);if(v){w-=v}return w<0};g.updateToken=function(v){var y=d();if(!g.tokenParsed||!g.refreshToken){y.setError();return y.promise}v=v||5;var w=function(){if(!g.isTokenExpired(v)){y.setSuccess(false)}else{var B="grant_type=refresh_token&refresh_token="+g.refreshToken;var z=l()+"/tokens/refresh";var A=new XMLHttpRequest();A.open("POST",z,true);A.setRequestHeader("Content-type","application/x-www-form-urlencoded");if(g.clientId&&g.clientSecret){A.setRequestHeader("Authorization","Basic "+btoa(g.clientId+":"+g.clientSecret))}else{B+="&client_id="+encodeURIComponent(g.clientId)}A.onreadystatechange=function(){if(A.readyState==4){if(A.status==200){var C=JSON.parse(A.responseText);p(C.access_token,C.refresh_token);g.onAuthRefreshSuccess&&g.onAuthRefreshSuccess();y.setSuccess(true)}else{g.onAuthRefreshError&&g.onAuthRefreshError();y.setError()}}};A.send(B)}};if(q.enable){var x=i();x.success(function(){w()}).error(function(){y.setError()})}else{w()}return y.promise};function l(){return g.authServerUrl+"/realms/"+encodeURIComponent(g.realm)}function r(){if(!a.location.origin){return a.location.protocol+"//"+a.location.hostname+(a.location.port?":"+a.location.port:"")}else{return a.location.origin}}function j(w,C){var A=w.code;var y=w.error;var v=w.prompt;if(A){var B="code="+A;var x=l()+"/tokens/access/codes";var z=new XMLHttpRequest();z.open("POST",x,true);z.setRequestHeader("Content-type","application/x-www-form-urlencoded");if(g.clientId&&g.clientSecret){z.setRequestHeader("Authorization","Basic "+btoa(g.clientId+":"+g.clientSecret))}else{B+="&client_id="+encodeURIComponent(g.clientId)}z.withCredentials=true;z.onreadystatechange=function(){if(z.readyState==4){if(z.status==200){var D=JSON.parse(z.responseText);p(D.access_token,D.refresh_token);g.onAuthSuccess&&g.onAuthSuccess();C&&C.setSuccess()}else{g.onAuthError&&g.onAuthError();C&&C.setError()}}};z.send(B)}else{if(y){if(v!="none"){g.onAuthError&&g.onAuthError();C&&C.setError()}else{C&&C.setSuccess()}}}}function h(x){var A=d();var w;if(!u){w="keycloak.json"}else{if(typeof u==="string"){w=u}}if(w){var z=new XMLHttpRequest();z.open("GET",w,true);z.setRequestHeader("Accept","application/json");z.onreadystatechange=function(){if(z.readyState==4){if(z.status==200){var B=JSON.parse(z.responseText);g.authServerUrl=B["auth-server-url"];g.realm=B.realm;g.clientId=B.resource;g.clientSecret=(B.credentials||{})["secret"];A.setSuccess()}else{A.setError()}}};z.send()}else{if(!u.url){var v=document.getElementsByTagName("script");for(var y=0;y<v.length;y++){if(v[y].src.match(/.*keycloak\.js/)){u.url=v[y].src.substr(0,v[y].src.indexOf("/js/keycloak.js"));break}}}if(!u.realm){throw"realm missing"}if(!u.clientId){throw"clientId missing"}g.authServerUrl=u.url;g.realm=u.realm;g.clientId=u.clientId;g.clientSecret=(u.credentials||{}).secret;A.setSuccess()}return A.promise}function o(){if(g.token){p(null,null);g.onAuthLogout&&g.onAuthLogout();if(g.loginRequired){g.login()}}}function p(x,w){if(x||w){t()}if(x){g.token=x;g.tokenParsed=JSON.parse(decodeURIComponent(escape(a.atob(x.split(".")[1]))));var y=g.realm+"/"+g.tokenParsed.sub;if(g.tokenParsed.session_state){y=y+"/"+g.tokenParsed.session_state}g.sessionId=y;g.authenticated=true;g.subject=g.tokenParsed.sub;g.realmAccess=g.tokenParsed.realm_access;g.resourceAccess=g.tokenParsed.resource_access;for(var v=0;v<k.length;v++){var z=k[v];if(g.tokenParsed[z]){if(!g.idToken){g.idToken={}}g.idToken[z]=g.tokenParsed[z]}}}else{delete g.token;delete g.tokenParsed;delete g.subject;delete g.realmAccess;delete g.resourceAccess;delete g.idToken;g.authenticated=false}if(w){g.refreshToken=w;g.refreshTokenParsed=JSON.parse(atob(w.split(".")[1]))}else{delete g.refreshToken;delete g.refreshTokenParsed}}function e(){var y=[];var v="0123456789abcdef";for(var w=0;w<36;w++){y[w]=v.substr(Math.floor(Math.random()*16),1)}y[14]="4";y[19]=v.substr((y[19]&3)|8,1);y[8]=y[13]=y[18]=y[23]="-";var x=y.join("");return x}g.callback_id=0;function n(){var v="<id: "+(g.callback_id++)+(Math.random())+">";return v}function f(w){if(w.indexOf("?")!=-1){var v={};var z=w.split("?")[1].split("&");for(var x=0;x<z.length;x++){var y=z[x].split("=");switch(decodeURIComponent(y[0])){case"code":v.code=y[1];break;case"error":v.error=y[1];break;case"state":v.state=decodeURIComponent(y[1]);break;case"redirect_fragment":v.fragment=decodeURIComponent(y[1]);break;case"prompt":v.prompt=y[1];break}}if((v.code||v.error)&&v.state&&v.state==sessionStorage.oauthState){delete sessionStorage.oauthState;return v}}}function d(){var v={setSuccess:function(w){v.success=true;v.result=w;if(v.successCallback){v.successCallback(w)}},setError:function(w){v.error=true;v.result=w;if(v.errorCallback){v.errorCallback(w)}},promise:{success:function(w){if(v.success){w(v.result)}else{if(!v.error){v.successCallback=w}}return v.promise},error:function(w){if(v.error){w(v.result)}else{if(!v.success){v.errorCallback=w}}return v.promise}}};return v}function t(){var z=d();if(!q.enable){return}if(q.iframe){z.setSuccess();return}var x=document.createElement("iframe");x.onload=function(){var A=l();if(A.charAt(0)==="/"){q.iframeOrigin=r()}else{q.iframeOrigin=A.substring(0,A.indexOf("/",8))}q.iframe=x;z.setSuccess()};var y=l()+"/login-status-iframe.html?client_id="+encodeURIComponent(g.clientId)+"&origin="+r();x.setAttribute("src",y);x.style.display="none";document.body.appendChild(x);var w=function(A){if(A.origin!==q.iframeOrigin){return}var B=A.data;var C=q.callbackMap[B.callbackId];delete q.callbackMap[B.callbackId];if((!g.sessionId||g.sessionId==B.session)&&B.loggedIn){C.setSuccess()}else{o();C.setError()}};a.addEventListener("message",w,false);var v=function(){i();if(g.token){setTimeout(v,q.interval*1000)}};setTimeout(v,q.interval*1000);return z.promise}function i(){var x=d();if(q.iframe&&q.iframeOrigin){var w={};w.callbackId=n();q.callbackMap[w.callbackId]=x;var v=q.iframeOrigin;q.iframe.contentWindow.postMessage(w,v)}else{x.setSuccess()}return x.promise}function s(v){if(!v||v=="default"){return{login:function(w){a.location.href=g.createLoginUrl(w);return d().promise},logout:function(w){a.location.href=g.createLogoutUrl(w);return d().promise},accountManagement:function(){a.location.href=g.createAccountUrl();return d().promise},redirectUri:function(x){if(x&&x.redirectUri){return x.redirectUri}else{if(g.redirectUri){return g.redirectUri}else{var w=(location.protocol+"//"+location.hostname+(location.port&&(":"+location.port))+location.pathname);if(location.hash){w+="?redirect_fragment="+encodeURIComponent(location.hash.substring(1))}return w}}}}}if(v=="cordova"){q.enable=false;return{login:function(x){var B=d();var A="location=no";if(x&&x.prompt=="none"){A+=",hidden=yes"}var z=g.createLoginUrl(x);var y=a.open(z,"_blank",A);var C;var w;y.addEventListener("loadstart",function(D){if(D.url.indexOf("http://localhost")==0){C=f(D.url);y.close()}});y.addEventListener("loaderror",function(D){if(D.url.indexOf("http://localhost")!=0){w=true;y.close()}});y.addEventListener("exit",function(D){if(w||!C){B.setError()}else{j(C,B)}});return B.promise},logout:function(y){var A=d();var w=g.createLogoutUrl(y);var z=a.open(w,"_blank","location=no,hidden=yes");var x;z.addEventListener("loadstart",function(B){if(B.url.indexOf("http://localhost")==0){z.close()}});z.addEventListener("loaderror",function(B){if(B.url.indexOf("http://localhost")!=0){x=true;z.close()}});z.addEventListener("exit",function(B){if(x){A.setError()}else{o();A.setSuccess()}});return A.promise},accountManagement:function(){var w=g.createAccountUrl();var x=a.open(w,"_blank","location=no");x.addEventListener("loadstart",function(y){if(y.url.indexOf("http://localhost")==0){x.close()}})},redirectUri:function(w){return"http://localhost"}}}throw"invalid adapter type: "+v}var k=["name","given_name","family_name","middle_name","nickname","preferred_username","profile","picture","website","email","email_verified","gender","birthdate","zoneinfo","locale","phone_number","phone_number_verified","address","updated_at","formatted","street_address","locality","region","postal_code","country","claims_locales"]};if(typeof module==="object"&&module&&typeof module.exports==="object"){module.exports=b}else{a.Keycloak=b;if(typeof define==="function"&&define.amd){define("keycloak",[],function(){return b})}}})(window);